## 왜 로드밸런서를 사용해야 하는가?

로드밸런서는 서버나 장비의 부하를 분산하기 위해 사용합니다. 사용자 천 명의 요청을 처리해주는 서버의 금액은 사용자 500명의 요청을 처리해주는 서버보다 단순히 2배 비싼 것이 아니라 훨씬 더 비쌉니다.  그러나 여러 대의 서버를 운영하다 보면 특정 서버에 트래픽 등의 부하가 몰리는 경우가 생길 수 있습니다.

로드밸런서는 여러 대의 서버로 트래픽을 균등하게 보내줌으로써 특정 서버에 부하가 몰리는 것을 방지하고 각각의 서버가 최적의 퍼포먼스를 유지할 수 있도록 해주는 도구입니다.

## L4 vs L7

L4와 L7은 OSI 7계층에서 전송계층(L4)과 애플리케이션 계층(L7)을 말합니다. OSI 7계층에 대해서는 [위키피디아 링크](https://ko.wikipedia.org/wiki/OSI_모형)를 참조해주시기 바랍니다. 어떤 계층에서 로드 밸런싱을 하느냐에 따라 각각의 장단점이 있습니다.

### L4 로드밸런서

주로 Round Robin 방식을 사용하며, 네트워크 계층(IP, IPX)이나 트랜스포트 계층(TCP, UDP)의 정보를 바탕으로 로드를 분산시킨다.

L7에 비해 가격이 저렴하다는 장점이 있습니다. 데이터를 들여다보지 않고 패킷 레벨에서만 로드를 분산하므로 속도도 빠릅니다.

극도의 성능이 요구되는 TCP(Transmission Control Protocol), UDP(User Datagram Protocol) 및 TLS(전송 계층 보안) 트래픽의 로드 밸런싱에 가장 적합하며, AWS의 NLB(Network LoadBalancer)가 L4 로드 밸런싱 전용 컴포넌트입니다.

### L7 로드밸런서

L7 로드밸런서는 애플리케이션 계층(HTTP, FTP, SMTP)에서 로드를 분산하기 때문에 HTTP 헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능합니다. 즉, 패킷(컨텐츠)를 확인한 후 그 내용에 따라 로드를 특정 서버에 분배하는 방식입니다.

HTTP 및 HTTPS 트래픽의 로드 밸런싱에 가장 적합하며, AWS의 ALB(Application LoadBalancer)가 L7 로드 밸런싱 전용 컴포넌트입니다.

![aws-aws-nds-aws-summit-seoul-2019-27-638](https://user-images.githubusercontent.com/19471818/114289550-d0edc900-9ab3-11eb-8395-6f3723bbf2bb.jpg)

### 로드밸런서 알고리즘

- 라운드로빈
  - 구성된 장비에 부하를 순차적으로 분산하는 방식
  - 기기별로 누적 세션 수는 동일하지만, 활성화된 세션 수는 달라질 수 있음
- 해시
  - 해시 알고리즘을 이용하여 부하를 분산하는 방식
- 최소 접속 방식
  - 현재 구성된 장비 중 활성화된 세션 수가 가장 적은 장비로 부하를 분산하는 방식
- 그 외에도 가중치 기반 라운드 로빈, 최소 접속 방식도 사용됨

### 출처

- [L4 load balancer vs L7 load balancer 란?](https://velog.io/@makeitcloud/란-L4-load-balancer-vs-L7-load-balancer-란)
- [[AWS\] 로드밸런싱 알아보기](https://medium.com/harrythegreat/aws-로드밸런싱-알아보기-9fd0955f859e)
- [IT 엔지니어를 위한 네트워크 입문](http://www.yes24.com/Product/Goods/93997435)